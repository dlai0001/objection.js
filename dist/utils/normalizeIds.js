var _require=require('../utils/objectUtils'),isObject=_require.isObject;module.exports=function(ids,prop,opt){opt=opt||{};var isComposite=prop.size>1;var ret=void 0;if(isComposite){if(Array.isArray(ids)){if(Array.isArray(ids[0])){ret=new Array(ids.length);for(var i=0,l=ids.length;i<l;++i){ret[i]=convertIdArrayToObject(ids[i],prop);}}else if(isObject(ids[0])){ret=new Array(ids.length);for(var _i=0,_l=ids.length;_i<_l;++_i){ret[_i]=ensureObject(ids[_i],prop);}}else{ret=[convertIdArrayToObject(ids,prop)];}}else if(isObject(ids)){ret=[ids];}else{throw new Error('invalid composite key '+JSON.stringify(ids));}}else{if(Array.isArray(ids)){if(isObject(ids[0])){ret=new Array(ids.length);for(var _i2=0,_l2=ids.length;_i2<_l2;++_i2){ret[_i2]=ensureObject(ids[_i2]);}}else{ret=new Array(ids.length);for(var _i3=0,_l3=ids.length;_i3<_l3;++_i3){ret[_i3]={};prop.setProp(ret[_i3],0,ids[_i3]);}}}else if(isObject(ids)){ret=[ids];}else{var obj={};prop.setProp(obj,0,ids);ret=[obj];}}checkProperties(ret,prop);if(opt.arrayOutput){return normalizedToArray(ret,prop);}else{return ret;}};function convertIdArrayToObject(ids,prop){if(!Array.isArray(ids)){throw new Error('invalid composite key '+JSON.stringify(ids));}if(ids.length!=prop.size){throw new Error('composite identifier '+JSON.stringify(ids)+' should have '+prop.size+' values');}var obj={};for(var i=0;i<ids.length;++i){prop.setProp(obj,i,ids[i]);}return obj;}function ensureObject(ids){if(isObject(ids)){return ids;}else{throw new Error('invalid composite key '+JSON.stringify(ids));}}function checkProperties(ret,prop){for(var i=0,l=ret.length;i<l;++i){var obj=ret[i];for(var j=0,lp=prop.size;j<lp;++j){var val=prop.getProp(obj,j);if(typeof val==='undefined'){throw new Error('expected id '+JSON.stringify(obj)+' to have property '+prop.propDescription(j));}}}}function normalizedToArray(ret,prop){var arr=new Array(ret.length);for(var i=0,l=ret.length;i<l;++i){arr[i]=prop.getProps(ret[i]);}return arr;}