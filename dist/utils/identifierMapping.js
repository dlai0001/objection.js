var _require=require('./objectUtils'),isObject=_require.isObject;function memoize(func){var cache=new Map();return function(input){var output=cache.get(input);if(output===undefined){output=func(input);cache.set(input,output);}return output;};}function snakeCase(str){var _ref=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},_ref$upperCase=_ref.upperCase,upperCase=_ref$upperCase===undefined?false:_ref$upperCase,_ref$underscoreBefore=_ref.underscoreBeforeDigits,underscoreBeforeDigits=_ref$underscoreBefore===undefined?false:_ref$underscoreBefore;if(str.length===0){return str;}var upper=str.toUpperCase();var lower=str.toLowerCase();var out=lower[0];for(var i=1,l=str.length;i<l;++i){var char=str[i];var prevChar=str[i-1];var upperChar=upper[i];var prevUpperChar=upper[i-1];var lowerChar=lower[i];var prevLowerChar=lower[i-1];if(underscoreBeforeDigits&&isDigit(char)&&!isDigit(prevChar)){out+='_'+char;continue;}if(char===upperChar&&upperChar!==lowerChar){if(prevChar===prevUpperChar&&prevUpperChar!==prevLowerChar){out+=lowerChar;}else{out+='_'+lowerChar;}}else{out+=char;}}if(upperCase){return out.toUpperCase();}else{return out;}}function camelCase(str){var _ref2=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},_ref2$upperCase=_ref2.upperCase,upperCase=_ref2$upperCase===undefined?false:_ref2$upperCase;if(str.length===0){return str;}if(upperCase&&isAllUpperCaseSnakeCase(str)){str=str.toLowerCase();}var out=str[0];for(var i=1,l=str.length;i<l;++i){var char=str[i];var prevChar=str[i-1];if(char!=='_'){if(prevChar==='_'){out+=char.toUpperCase();}else{out+=char;}}}return out;}function isAllUpperCaseSnakeCase(str){for(var i=1,l=str.length;i<l;++i){var char=str[i];if(char!=='_'&&char!==char.toUpperCase()){return false;}}return true;}function isDigit(char){return char>='0'&&char<='9';}function mapLastPart(mapper,separator){return function(str){var idx=str.lastIndexOf(separator);var mapped=mapper(str.slice(idx+separator.length));return str.slice(0,idx+separator.length)+mapped;};}function keyMapper(mapper){return function(obj){if(!isObject(obj)||Array.isArray(obj)){return obj;}var keys=Object.keys(obj);var out={};for(var i=0,l=keys.length;i<l;++i){var key=keys[i];out[mapper(key)]=obj[key];}return out;};}function snakeCaseMappers(){var opt=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return{parse:keyMapper(memoize(function(str){return camelCase(str,opt);})),format:keyMapper(memoize(function(str){return snakeCase(str,opt);}))};}function knexIdentifierMappers(){var _ref3=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},parse=_ref3.parse,format=_ref3.format,_ref3$idSeparator=_ref3.idSeparator,idSeparator=_ref3$idSeparator===undefined?':':_ref3$idSeparator;var formatId=memoize(mapLastPart(format,idSeparator));var parseId=memoize(mapLastPart(parse,idSeparator));var parseKeys=keyMapper(parseId);return{wrapIdentifier:function wrapIdentifier(identifier,origWrap){return origWrap(formatId(identifier));},postProcessResponse:function postProcessResponse(result){if(Array.isArray(result)){var output=new Array(result.length);for(var i=0,l=result.length;i<l;++i){output[i]=parseKeys(result[i]);}return output;}else{return parseKeys(result);}}};}function knexSnakeCaseMappers(){var opt=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return knexIdentifierMappers({parse:function parse(str){return camelCase(str,opt);},format:function format(str){return snakeCase(str,opt);}});}function knexIdentifierMapping(colToProp){var propToCol=Object.keys(colToProp).reduce(function(propToCol,column){propToCol[colToProp[column]]=column;return propToCol;},{});return knexIdentifierMappers({parse:function parse(column){return colToProp[column]||column;},format:function format(prop){return propToCol[prop]||prop;}});}module.exports={snakeCase:snakeCase,camelCase:camelCase,snakeCaseMappers:snakeCaseMappers,knexSnakeCaseMappers:knexSnakeCaseMappers,knexIdentifierMappers:knexIdentifierMappers,knexIdentifierMapping:knexIdentifierMapping,camelCaseKeys:keyMapper(memoize(camelCase)),snakeCaseKeys:keyMapper(memoize(snakeCase))};